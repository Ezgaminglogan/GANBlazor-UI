@using Blazor.Heroicons
@using static GANBlazor.UI.Classes.UI.ButtonTypes

@if (IsOpen)
{
    <!-- Backdrop -->
    <div class="fixed inset-0 z-50 bg-zinc-900/50 backdrop-blur-sm animate-in fade-in duration-200"
         @onclick="HandleBackdropClick"></div>

    <!-- Modal -->
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none">
        <div class="@ModalCss pointer-events-auto"
             @onclick:stopPropagation="true">
            @ChildContent
        </div>
    </div>
}

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }
    [Parameter] public bool IsOpen { get; set; }
    [Parameter] public EventCallback<bool> IsOpenChanged { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }
    [Parameter] public ModalSize Size { get; set; } = ModalSize.Md;
    [Parameter] public bool CloseOnBackdropClick { get; set; } = true;
    [Parameter] public string? Class { get; set; }

    private string ModalCss =>
        string.Join(" ", new[]
        {
            "bg-white rounded-xl shadow-2xl w-full animate-in zoom-in-95 duration-200",
            SizeCss(),
            Class ?? ""
        }.Where(x => !string.IsNullOrWhiteSpace(x)));

    private string SizeCss() => Size switch
    {
        ModalSize.Sm => "max-w-sm",
        ModalSize.Md => "max-w-md",
        ModalSize.Lg => "max-w-lg",
        ModalSize.Xl => "max-w-xl",
        ModalSize.Full => "max-w-full mx-4",
        _ => "max-w-md"
    };

    private async Task HandleBackdropClick()
    {
        if (CloseOnBackdropClick)
            await CloseModal();
    }

    private async Task CloseModal()
    {
        IsOpen = false;
        await IsOpenChanged.InvokeAsync(false);
        if (OnClose.HasDelegate)
            await OnClose.InvokeAsync();
    }
}
